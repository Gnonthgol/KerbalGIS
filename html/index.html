
<html>
	<head>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
		<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
		<style>
			.info {
				padding: 6px 8px;
				font: 14px/16px Arial, Helvetica, sans-serif;
				background: white;
				background: rgba(255,255,255,0.8);
				box-shadow: 0 0 15px rgba(0,0,0,0.2);
				border-radius: 5px;
			}
			.info h4 {
				margin: 0 0 5px;
				color: #777;
			}
			.legend {
				line-height: 18px;
				color: #555;
			}
			.legend i {
				width: 18px;
				height: 18px;
				float: left;
				margin-right: 8px;
				opacity: 0.7;
			}
		</style>
		<title>Kerbin - Sat</title>
	</head>
	<body>
	<div id="map" style="width: 100%; height: 100%"></div>
	<script>
		function GetXmlHttpObject() {
			if (window.XMLHttpRequest) { return new XMLHttpRequest(); }
			if (window.ActiveXObject)  { return new ActiveXObject("Microsoft.XMLHTTP"); }
			return null;
		}
		
		var currentBody = "Kerbin";
	
		var satLayer = L.tileLayer('http://localhost:8080/tile/'+currentBody+'/sat/{z}/{x}/{y}.png', {
			maxZoom: 18,
		});
		var biomeLayer = L.tileLayer('http://localhost:8080/tile/'+currentBody+'/biome/{z}/{x}/{y}.png', {
			maxZoom: 18,
			opacity: 0.5,
		});
		var hillLayer = L.tileLayer('http://localhost:8080/tile/'+currentBody+'/hillshading/{z}/{x}/{y}.png', {
			maxZoom: 18,
			opacity: 0.5,
		});
		
		
		var map = L.map('map', {
    		center: new L.LatLng(0, 0),
    		zoom: 4,
		});
		
		map.addLayer(satLayer);
		
		L.control.layers({}, {"Satellite": satLayer, "Biomes": biomeLayer, "Hillshading": hillLayer}).addTo(map);
		
		var ajaxRequest=new XMLHttpRequest();
		if (ajaxRequest==null) {
			alert ("This browser does not support HTTP Request");
		}
		
		var legend = L.control({position: 'bottomright'});
		var bodyInfo;
		
		ajaxRequest.onreadystatechange = function () {
			if (ajaxRequest.readyState==4 && ajaxRequest.status==200) {
				bodyInfo=eval("(" + ajaxRequest.responseText + ")");
				legend.addTo(map);
			}
		};
		ajaxRequest.open('GET', "http://localhost:8080/info.json", true);
		ajaxRequest.send(null);

		legend.onAdd = function (map) {
			var div = L.DomUtil.create('div', 'info legend');
			var labels = [];
			var biomes = bodyInfo[currentBody].biomes;
			for (var i = 0; i < biomes.length; i++) {
				labels.push('<i style="background:' + biomes[i].color + '"></i> ' + biomes[i].name);
			}
			div.innerHTML = labels.join('<br>');
			
			return div;
		};
	</script>
	</body>
</html>
